<!DOCTYPE html>
<html>
<head>
    <title>Chalon Traffic Control</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<div id="layout">
    <div id="map-container">
        <canvas id="mapCanvas"></canvas>
        <div id="alert">TRAVAUX AJOUTÉS</div>
    </div>

    <div id="sidebar">
        <h2>CHALON S/ SAÔNE</h2>

        <div class="panel">
            <div style="text-align:center; color:#aaa; font-size:12px; margin-bottom:5px;">FLOTTE (100 - 3000)</div>
            <div style="text-align:center; font-size:24px; font-weight:bold; color:#fff" id="car-val">600</div>
            <input type="range" id="car-slider" min="100" max="3000" step="100" value="600"
                   oninput="document.getElementById('car-val').innerText = this.value">

            <button class="btn btn-start" onclick="startSim()">▶ INITIALISER</button>
            <button class="btn btn-stop" onclick="stopSim()">⏹ STOP</button>
        </div>

        <div class="panel">
            <div class="stat-row"><span>État</span> <span id="st-mode" style="color:#aaa">Prêt</span></div>
            <div class="stat-row"><span>Arrivées</span> <span id="st-trips" class="val">0</span></div>
            <div class="stat-row"><span>Congestion</span> <span id="st-cong" class="val ok">0%</span></div>
            <div class="stat-row"><span>Cycle Moy.</span> <span id="st-cycle" style="color:#ffff00">40s</span></div>
        </div>

        <button id="btn-ai" class="btn btn-ai" onclick="toggleAI()">⚡ Smart Grid (IA)</button>

        <div style="flex-grow:1; position:relative; min-height:150px; margin-top:20px;">
            <canvas id="chart"></canvas>
        </div>

        <div class="legend">
            <span><span class="dot" style="background:#fff;"></span>Auto</span>
            <span><span class="dot" style="background:#00ff00;"></span>Vert</span>
            <span><span class="dot" style="background:#ff0000;"></span>Rouge</span>
            <span><span class="square" style="background:#ffff00;"></span>Travaux</span>
        </div>

        <div style="font-size:11px; color:#777; text-align:center; margin-top:15px; border-top:1px solid #444; padding-top:10px;">
            Molette : Zoom <br> Clic Gauche : Pan <br> Clic Droit : Travaux
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>